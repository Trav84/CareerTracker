<!DOCTYPE html>
<html>
<head>
	<title>Iron Tracker</title>
	<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.2/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.2/JSXTransformer.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css">
	<link rel="stylesheet" type="text/css" href="bower_components/normalize.css/normalize.css">
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<section id="mount-point"></section>
	<section id="mount-point2"></section>
	<script type="text/jsx">

	/** @jsx React.DOM */
	var ref = new Firebase('https://blistering-torch-743.firebaseio.com/');

	var NavComponent = React.createClass({ 
		getInitialState: function() {
        	return { showResults: false };
    	},
		onClick: function() {
        	this.setState({ showResults: !this.state.showResults });
   	 	},	
		render: function() {
			return (
				<header>
					<h1> Iron Tracker </h1>
					<h2> Tracking Iron Yarders Quest For Jobs </h2>
					<nav>
						<a href="#"> Home </a>
						<a href="#"> Job Search Stats </a>
						<a className="submit-button" href="#" onClick={this.onClick}> Submit Information </a>
					</nav>
					{ this.state.showResults ? <PostComponent /> : null }
				</header>
			)
		}
	});

	var PostComponent = React.createClass({
		handleSubmit: function(e) {
			e.preventDefault();
			var user = {};

			user.username = React.findDOMNode(this.refs.username).value;
			user.applications = React.findDOMNode(this.refs.application).value;
			user.referrals = React.findDOMNode(this.refs.referrals).value;
			user.interviews = React.findDOMNode(this.refs.interviews).value;
			user.technicalInterviews = React.findDOMNode(this.refs.techInterviews).value;
			user.status = React.findDOMNode(this.refs.status).value;

			var usersRef = ref.child("profiles/"+user.username);
			usersRef.update(user);

			return;	
		},
		render: function() {
			return (
				
				<div className ="submit-bar">
					<form onSubmit={this.handleSubmit}>
						<label> 
							Name 
							<input type="text" placeholder="Sally Sue" ref="username" />
						</label>
						
						<label> 
							Applications
							<input type="text" placeholder="10" ref="application" />
						</label>
						
						<label>
							Referrals/Contacts
							<input type="text" placeholder="3" ref="referrals" />
						</label>
						
						<label>
							Interviews
							<input type="text" placeholder="5" ref="interviews" />
						</label>
						
						<label>
							Technical Interviews/Assignments
							<input type="text" placeholder="2" ref="techInterviews" />
						</label>
						
						<label>
							Employement Status
							<input type="text" placeholder="Hired/Looking/Other" ref="status" />
						</label>
						
						<input className ="button" type="submit" value="Submit" />
					</form>
				</div>
			)
		}
	});

	var IndividualProfile = React.createClass({
	  render: function() {
	    var createItem = function(profile, index) {
	      return (
	      	<section className="iron-yarder-profile">
				<div className="profile-image"><i className="fa fa-user fa-3x"></i></div>
				<table>
					<tr>
						<td> Name </td>
						<td> { profile.username } </td>
					</tr>
					<tr>
						<td> Applications </td>
						<td> { profile.applications } </td>
					</tr>
					<tr>
						<td> Referrals/Connections </td>
						<td> { profile.referrals } </td>
					</tr>
					<tr>
						<td> Interviews </td>
						<td> { profile.interviews }</td>
					</tr>
					<tr>
						<td> Technical Interviews </td>
						<td> { profile.technicalInterviews }</td>
					</tr>
					<tr>
						<td> Emplyoment Status </td>
						<td> { profile.status }</td>
					</tr>
				</table>
			</section>
			)
	    };
	    return <ul>{ this.props.profiles.map(createItem) }</ul>;
	  }
	});

	var ProfileComponent = React.createClass({
		getInitialState: function() {
			this.profiles = [];
   			return {profiles: []};
  		},
		componentWillMount: function() {
			this.firebaseRef = new Firebase("https://blistering-torch-743.firebaseio.com/profiles");
			this.changeRef = new Firebase("https://blistering-torch-743.firebaseio.com");
			// this.firebaseRef.on("child_changed", function(snapshot) {
			// 	console.log('changed event occured');
			// 	this.profiles.push(snapshot.val())
			// 	this.setState({
			// 		profiles: this.profiles
			// 	});
			//}.bind(this));
			this.firebaseRef.on("value", function(snapshot) {
				console.log('grabbed Firebase values');
				this.profiles.push(snapshot.val())
				this.setState({
					profiles: this.profiles
				});
			}.bind(this));
		},
		componentWillUnmount: function() {
  			this.firebaseRef.off();
		},
		render: function() {
			var profiles = [];
			for(var i in this.profiles[0]) {
				profiles.push(this.profiles[0][i]);
			}
			return (
				<IndividualProfile profiles={ profiles } />
			)
		}
	});

	React.render(
	    <NavComponent />,
	    document.getElementById('mount-point')
	);

	React.render(
	    <ProfileComponent />,
	    document.getElementById('mount-point2')
	);

	</script>
	<script src="main.js"></script>
</body>
</html>